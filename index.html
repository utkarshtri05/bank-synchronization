<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Thread Sync Demo — Bank Withdrawals</title>
  <style>
    :root {
      --bg: #0f172a;       /* slate-900 */
      --panel: #111827;    /* gray-900 */
      --muted: #94a3b8;    /* slate-400 */
      --text: #e5e7eb;     /* gray-200 */
      --accent: #22c55e;   /* green-500 */
      --warn: #f59e0b;     /* amber-500 */
      --danger: #ef4444;   /* red-500 */
      --ring: rgba(34,197,94,.35);
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
      background: radial-gradient(1200px 800px at 20% -10%, #1f2937 0%, var(--bg) 50%);
      color: var(--text);
    }
    .wrap { max-width: 980px; margin: 40px auto; padding: 0 20px; }
    header { display: flex; align-items: center; justify-content: space-between; gap: 16px; }
    h1 { font-size: clamp(22px, 2.4vw, 34px); margin: 0; letter-spacing: .3px; }
    .sub { color: var(--muted); font-size: 14px; margin-top: 6px; }

    .balance-card {
      margin-top: 20px; background: linear-gradient(180deg, #0b1220, #0a0f1a);
      border: 1px solid #1f2937; border-radius: 18px; padding: 18px 18px 14px; box-shadow: 0 10px 30px rgba(0,0,0,.35);
    }
    .balance-row { display: flex; align-items: center; justify-content: space-between; gap: 12px; }
    .balance {
      font-size: clamp(28px, 4.2vw, 48px); font-weight: 700; letter-spacing: .5px;
      background: linear-gradient(90deg, #a7f3d0, #86efac, #d1fae5);
      -webkit-background-clip: text; background-clip: text; color: transparent;
    }
    .controls { display: flex; gap: 10px; flex-wrap: wrap; }
    .btn { background: #111827; border: 1px solid #374151; color: var(--text); padding: 10px 14px; border-radius: 12px; cursor: pointer; transition: .2s ease; font-weight: 600; }
    .btn:hover { transform: translateY(-1px); border-color: #4b5563; }
    .btn:active { transform: translateY(0); }
    .btn.accent { border-color: #14532d; background: #052e1a; }

    .toggle { display:flex; align-items:center; gap:10px; font-size:14px; color:var(--muted); }
    .toggle input { width: 42px; height: 22px; appearance: none; background:#111827; border:1px solid #334155; border-radius: 999px; position: relative; outline: none; cursor: pointer; }
    .toggle input:checked { border-color:#14532d; background:#052e1a; box-shadow:0 0 0 3px var(--ring); }
    .toggle input::after { content:""; position:absolute; top:2px; left:2px; width:18px; height:18px; background:#e5e7eb; border-radius:50%; transition:.2s; }
    .toggle input:checked::after { transform: translateX(20px); background:#86efac; }

    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 16px; margin-top: 16px; }
    .card { background: #0b1323; border: 1px solid #1f2937; border-radius: 18px; padding: 16px; box-shadow: 0 10px 30px rgba(0,0,0,.35); }
    .card h3 { margin: 0 0 10px; font-size: 18px; }
    label { display:block; font-size: 13px; color: var(--muted); margin-bottom: 6px; }
    input[type="number"] { width: 100%; padding: 10px 12px; border-radius: 12px; background: #0a0f1a; border: 1px solid #334155; color: var(--text); outline: none; }
    input[type="number"]:focus { border-color: #14532d; box-shadow: 0 0 0 3px var(--ring); }

    .log { margin-top: 18px; background: #0a0f1a; border: 1px solid #1f2937; border-radius: 16px; padding: 12px; height: 220px; overflow: auto; font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; font-size: 13px; }
    .log p { margin: 0 0 6px; }
    .muted { color: var(--muted); }
    .ok { color: #86efac; }
    .warn { color: var(--warn); }
    .bad { color: var(--danger); }
    footer { margin: 20px 0 60px; color: var(--muted); font-size: 12px; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Bank Withdrawal — Synchronization Demo</h1>
        <div class="sub">Java console app idea recreated for the browser. Turn the lock on/off to see the difference.</div>
      </div>
      <label class="toggle" title="When ON, withdrawals happen one-at-a-time using a lock.">
        <input id="syncToggle" type="checkbox" checked />
        <span>Use synchronization (lock)</span>
      </label>
    </header>

    <section class="balance-card">
      <div class="balance-row">
        <div>
          <div class="muted">Current Balance</div>
          <div id="balance" class="balance">₹5,000</div>
        </div>
        <div class="controls">
          <button class="btn accent" id="resetBtn" type="button">Reset ₹5,000</button>
          <button class="btn" id="clearBtn" type="button">Clear Log</button>
        </div>
      </div>
    </section>

    <div class="grid">
      <div class="card">
        <h3>Rahul</h3>
        <label for="rahulAmt">Amount to withdraw</label>
        <input id="rahulAmt" type="number" min="0" step="100" placeholder="e.g. 3000" />
        <div style="height:10px"></div>
        <button class="btn" id="rahulBtn" type="button">Withdraw</button>
      </div>
      <div class="card">
        <h3>Ravi</h3>
        <label for="raviAmt">Amount to withdraw</label>
        <input id="raviAmt" type="number" min="0" step="100" placeholder="e.g. 2500" />
        <div style="height:10px"></div>
        <button class="btn" id="raviBtn" type="button">Withdraw</button>
      </div>
    </div>

    <div class="log" id="log" aria-live="polite"></div>

    <footer>
      Tip: Turn OFF the lock, enter two amounts, and press both buttons quickly to see a race condition. With the lock ON, operations queue up safely — just like <code>synchronized(x1)</code> in Java.
    </footer>
  </div>

  <script>
    // --- State ---
    let balance = 5000;
    let locked = false;            // our simple mutex
    const $ = id => document.getElementById(id);
    const fmt = n => `₹${n.toLocaleString('en-IN')}`;
    const sleep = ms => new Promise(res => setTimeout(res, ms));

    function setBalance(n) {
      balance = n;
      $('balance').textContent = fmt(balance);
    }

    function log(line, cls = '') {
      const p = document.createElement('p');
      p.textContent = line;
      if (cls) p.classList.add(cls);
      $('log').appendChild(p);
      $('log').scrollTop = $('log').scrollHeight;
    }

    async function criticalSection(name, amount) {
      // Simulate network/processing delay so races are visible
      await sleep(400 + Math.random() * 900);
      if (balance >= amount) {
        setBalance(balance - amount);
        log(`${name}: Withdrawal of ${fmt(amount)} successful. New balance ${fmt(balance)}.`, 'ok');
      } else {
        log(`${name}: Insufficient balance for ${fmt(amount)}. Current ${fmt(balance)}.`, 'bad');
      }
    }

    async function withdraw(name, amount) {
      const syncOn = $('syncToggle').checked;
      const amt = Number(amount);
      if (!Number.isFinite(amt) || amt <= 0) {
        log(`${name}: Enter a valid amount.`, 'warn'); return;
      }
      log(`${name}: Request to withdraw ${fmt(amt)} received.`, 'muted');

      if (syncOn) {
        // Acquire the lock (spin-wait with small sleeps)
        while (locked) { await sleep(30); }
        locked = true;
        try {
          await criticalSection(name, amt);
        } finally {
          locked = false; // release
        }
      } else {
        // No lock: fire-and-forget (intentionally not awaited)
        criticalSection(name, amt);
      }
    }

    // --- Wire up UI ---
    $('rahulBtn').addEventListener('click', () => withdraw('Rahul', $('rahulAmt').value));
    $('raviBtn').addEventListener('click',  () => withdraw('Ravi',  $('raviAmt').value));
    $('resetBtn').addEventListener('click', () => { setBalance(5000); log('Balance reset to ₹5,000.', 'muted'); });
    $('clearBtn').addEventListener('click', () => { $('log').innerHTML = ''; });

    // init
    setBalance(balance);
  </script>
</body>
</html>
